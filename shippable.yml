language: none

runtime:
    nodePool: shippable_shared_aarch64
    # nodePool: shippable_shared_aarch32

env:
  global:
    # The BINSTAR_TOKEN secure variable. This is defined canonically in conda-forge.yml.
  matrix:
    - CONFIG=linux_aarch64_
      UPLOAD=False

build:
  pre_ci_boot:
    # It really doesn't like the centos image.....
    # image_name: arm64v8/centos
    # image_tag: '7'

    image_name: arm64v8/ubuntu
    image_tag: 18.04
    pull: True

  ci:
    # Need to install bzip2 for conda
    - apt-get update
    # bzip2 is necessary for conda installers to get executed
    # curl is necessary to download them
    - apt-get install -y bzip2 curl locales
    
    - dpkg-reconfigure --frontend=noninteractive locales

    - curl -L -O https://github.com/Archiconda/build-tools/releases/download/0.2.2/Archiconda3-0.2.2-Linux-aarch64.sh
    - bash Archiconda3*.sh -b -p /root/archiconda3
    - export PATH="/root/archiconda3/bin:${PATH}"
    - source /root/archiconda3/bin/activate root
    - conda --version
    - conda config --show
    # My archiarm adds itself to the default channels, lets just see if this works
    # - conda config --remove channels archiarm
    - conda install --yes --quiet conda-forge-ci-setup=2 conda-build -c conda-forge
    - pwd
    - ls -lah
    - export FEEDSTOCK_ROOT=.
    - export RECIPE_ROOT=../recipe_root
    - export CI_SUPPORT="${FEEDSTOCK_ROOT}/.ci_support"
    - export CONFIG_FILE="${CI_SUPPORT}/${CONFIG}.yaml"
    - conda install --yes --quiet conda-forge-ci-setup=2 conda-build -c conda-forge
    - setup_conda_rc "${FEEDSTOCK_ROOT}" "${RECIPE_ROOT}" "${CONFIG_FILE}"
    - run_conda_forge_build_setup
    - make_build_number "${FEEDSTOCK_ROOT}" "${RECIPE_ROOT}" "${CONFIG_FILE}"
    - conda build "${RECIPE_ROOT}" -m "${CI_SUPPORT}/${CONFIG}.yaml" --clobber-file "${CI_SUPPORT}/clobber_${CONFIG}.yaml"
    

# disable email notification
# of CI job result
integrations:
  notifications:
    - integrationName: email
      type: email
      on_success: never
      on_failure: never
      on_cancel: never
      on_pull_request: never
